subtitle = "Seasonally unadjusted values for core CPI inflation, 1-month percent change, not annualized.",
caption = "Inspired by Paul Romer's blog. Mike Konczal"
)
}
##### SET UP SOME THINGS #####
cpi_versus_pce <- function(cpi_df, compare_length = 6, start_graphic = "2014-01-01", breaks_value = 6, title="",
legend.position.c = c(0.5,0.60), colors = c("6-Month Core CPI Change" = "#BA68C8", "6-Month Core PCE Change" = "#4F97D7"),
label_length = 6,
column_alpha=0.2) {
getSymbols("PCEPILFE", src = "FRED")
# Convert the data to a tibble
pce_data <- data.frame(date = index(get("PCEPILFE")), Value = coredata(get("PCEPILFE"))) %>%
as_tibble() %>% rename(core_pce6A = PCEPILFE) %>%
mutate(core_pce6A = core_pce6A/lag(core_pce6A, 6),
core_pce6A = core_pce6A^2 - 1)
breaks_value <- generate_dates(cpi_df$date, breaks_value)
# Data manipulation
cpi_df <- make_three_six_data(cpi_df, "All items less food and energy", 6) %>% filter(time_length == "6-Month Change") %>% select(date, core_cpi6A = change) %>%
left_join(pce_data, by="date") %>%
pivot_longer(core_cpi6A:core_pce6A, names_to = "time_length", values_to = "change") %>%
group_by(time_length) %>%
mutate(
last_value = ifelse(date==max(date),change,NA),
last_valueL = ifelse(!is.na(last_value), paste0(format(date, '%b, %Y'), "\n", label_percent(accuracy=0.1)(round(last_value,3))), NA)) %>%
ungroup() %>%
mutate(
time_length = case_when(
time_length == "core_cpi6A" ~ "6-Month Core CPI Change",
time_length == "core_pce6A" ~ "6-Month Core PCE Change",
TRUE ~ time_length
)
)
inf_diff <- cpi_df %>% select(-last_value, -last_valueL) %>%
pivot_wider(names_from = time_length, values_from = change) %>%
clean_names() %>%
mutate(inf_diff_1 = x6_month_core_cpi_change - x6_month_core_pce_change) %>%
select(date, inf_diff_1) %>%
mutate(time_length = "6-Month Core CPI Change")
# Plot
p <- cpi_df %>%
filter(date >= start_graphic) %>%
left_join(inf_diff, by=c("date","time_length")) %>%
ggplot(aes(date, change, color=time_length,label=last_valueL)) +
geom_line(size=1.6) +
geom_text_repel(
show.legend=FALSE, nudge_x = 85, min.segment.length = Inf
) +
geom_col(aes(date, inf_diff_1), alpha=column_alpha, size=0, show.legend = FALSE) +
labs(
x="", y="",
title=title,
subtitle = "Core CPI inflation vs core PCE inflation, 6-month change, annualized. Bars measure difference between them.",
caption = "CPI: BLS, All items less food and energy. PCE: BEA, PCE excluding food and energy, Author's calculations. Mike Konczal."
) +
theme_esp() +
scale_color_manual(values=colors) +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_labels = "%b\n%Y", breaks=breaks_value) +
theme(
panel.grid.major.y = element_line(size=0.5),
legend.position = legend.position.c,
legend.text = element_text(size=15)
)
return(p)
}
core_3_6_title <- "Services less Shelter Still Elevated in June"
g <- three_six_graphic(cpi, "Services less rent of shelter", "2018-01-01", "2020-01-01", "2023-01-01",
title = core_3_6_title, include_3_6 = TRUE, column_alpha = 0.2,
colors = c("3-Month Change" = "#2c3254", "6-Month Change" = "#ff8361"))
ggsave("graphics/supercore.png", dpi="retina", width = 12, height=6.75, units = "in")
cpi %>%
filter(item_name %in% trump_targets) %>%
filter(year(date) >= start_trump_year) %>%
ggplot(aes(date, Pchange1)) +
geom_line() + geom_line() +
theme_esp() +
facet_wrap(~item_name, scales = "free") +
labs(title="Likely targets for Trump tariffs.",
subtitle = "Monthly change, seasonally adjusted, not-annualized.",
caption="Seasonally adjusted, CPI. Mike Konczal.") +
geom_hline(yintercept = 0) +
theme(plot.title.position = "plot")
cpi %>%
filter(item_name %in% trump_targets) %>%
filter(year(date) >= start_trump_year) %>%
ggplot(aes(date, Pchange1)) +
geom_line(color = "#2c3254") +
theme_esp() +
facet_wrap(~item_name, scales = "free") +
scale_y_continuous(label = percent) +
labs(title="Likely targets for Trump tariffs.",
subtitle = "Monthly change, seasonally adjusted, not-annualized.",
caption="Seasonally adjusted, CPI. Mike Konczal.") +
geom_hline(yintercept = 0) +
theme(plot.title.position = "plot")
ggsave("graphics/trump_tariff_targets.png", dpi="retina", width = 12, height=6.75, units = "in")
core_3_6_title <- "What's up with autos?"
three_six_graphic(cpi, "Transportation commodities less motor fuel", "2018-01-01", "2020-01-01", "2021-01-01",
title = core_3_6_title, include_3_6 = TRUE, column_alpha = 0.2,
colors = c("3-Month Change" = "#9467BD", "6-Month Change" = "#C5B0D5")
)
# transportation services breakdown
subtract_array <- c("Car and truck rental", "Motor vehicle insurance", "Motor vehicle fees", "Public transportation","Motor vehicle maintenance and repair")
services_breakdown <- subtract_cpi_items(cpi, "2018-01-01", "Transportation services",
subtract_array = subtract_array)
stacked_graphic(services_breakdown, unique(services_breakdown$item_name), start_date = "2022-01-01",
title = "What's Happening in Transportation Services?", date_breaks_length = 12, add_labels = TRUE, palette= "RdPu", legend.position = c(0.6,0.9))
ggsave("graphics/g_ts.png", dpi="retina", width = 12, height=6.75, units = "in")
# Real Wages ----
cpi_rate <- cpi %>% filter(series_id == "CUSR0000SA0") %>%
select(date, cpi_rate = value)
ahe <- getFRED("CES0500000003", rename_variables = "ahe") %>%
inner_join(cpi_rate, by="date") %>%
mutate(real_wages = ahe/cpi_rate,
real_wages4m = real_wages/lag(real_wages, 4)-1,
real_wages1m = real_wages/lag(real_wages, 1)-1,
real_wages_Trump = real_wages/real_wages[date == "2025-01-01"]-1)
ahe %>%
filter(year(date) >= 2025) %>%
ggplot(aes(date, real_wages_Trump)) +
geom_line(size = 1.2) +
theme_lass +
geom_hline(yintercept = 0, color = "white") +
scale_y_continuous(label = percent) +
scale_x_date(breaks = "1 month", date_labels = "%B\n%Y") +
labs(
title = "Real Wages Up or Down Under President Trump?",
subtitle = "Change in Average Hourly Earnings Divided by Overall CPI, Since January 2025.",
caption = "Mike Konczal"
)
ahe %>%
filter(year(date) >= 2025) %>%
ggplot(aes(date, real_wages_Trump)) +
geom_line(size = 1.2) +
theme_esp() +
geom_hline(yintercept = 0, color = "white") +
scale_y_continuous(label = percent) +
scale_x_date(breaks = "1 month", date_labels = "%B\n%Y") +
labs(
title = "Real Wages Up or Down Under President Trump?",
subtitle = "Change in Average Hourly Earnings Divided by Overall CPI, Since January 2025.",
caption = "Mike Konczal"
)
ggsave("graphics/real_wages_Trump.png", dpi = "retina", width = 12, height = 6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1) %>%
filter(year(date) >= 2018) %>%
ggplot(aes(date, value)) +
#ggplot(aes(date, Pchange1)) +
theme_lass +
geom_line(size = 1.2) +
facet_wrap(~item_name, scales = "free") +
geom_hline(yintercept = 0) +
scale_y_continuous(labels = percent) +
labs(subtitle="1-month percent change.",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1) %>%
filter(year(date) >= 2018) %>%
ggplot(aes(date, value)) +
#ggplot(aes(date, Pchange1)) +
theme_esp() +
geom_line(size = 1.2) +
facet_wrap(~item_name, scales = "free") +
geom_hline(yintercept = 0) +
scale_y_continuous(labels = percent) +
labs(subtitle="1-month percent change.",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1) %>%
filter(year(date) >= 2018) %>%
ggplot(aes(date, value)) +
#ggplot(aes(date, Pchange1)) +
theme_esp() +
geom_line(size = 1.2) +
facet_wrap(~item_name, scales = "free") +
geom_hline(yintercept = 0) +
labs(subtitle="1-month percent change.",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1) %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, value)) +
#ggplot(aes(date, Pchange1)) +
theme_esp() +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
geom_hline(yintercept = 0) +
labs(subtitle="1-month percent change.",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1) %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, value)) +
#ggplot(aes(date, Pchange1)) +
theme_esp() +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="1-month percent change.",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares"))
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares") %>% filter(date == max(date)))
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares") %>% filter(date == max(date))
)
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares"), date == max(date))
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1) %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, value)) +
#ggplot(aes(date, Pchange1)) +
theme_esp() +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, 1982-1984 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1) %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, value)) +
#ggplot(aes(date, Pchange1)) +
theme_esp() +
scale_x_date(breaks = generate_dates(date, 12)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, 1982-1984 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
generate_dates
MI_dates
cpi$generate_dates(date, 12)
generate_dates(cpi$date, 12)
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1) %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, value)) +
#ggplot(aes(date, Pchange1)) +
theme_esp() +
scale_x_date(breaks = generate_dates(cpi$date, 12)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, 1982-1984 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1) %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, value)) +
#ggplot(aes(date, Pchange1)) +
theme_esp() +
scale_x_date(breaks = generate_dates(cpi$date, 6)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, 1982-1984 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1,
indexN = value/value[date == "2025-01-01"]) %>%
ungroup() %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, indexN)) +
theme_esp() +
scale_x_date(breaks = generate_dates(cpi$date, 6)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, 1982-1984 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1,
indexN = 100*value/value[date == "2025-01-01"]) %>%
ungroup() %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, indexN)) +
theme_esp() +
scale_x_date(date_labels = "%b\n%Y", breaks = generate_dates(cpi$date, 6)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, Jan 2025 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1,
indexN = 100*value/value[date == "2024-12-01"]) %>%
ungroup() %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, indexN)) +
theme_esp() +
scale_x_date(date_labels = "%b\n%Y", breaks = generate_dates(cpi$date, 6)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, December 2024 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1,
indexN = 100*value/value[date == "2024-12-01"]) %>%
ungroup() %>%
filter(year(date) >= 2022) %>%
ggplot(aes(date, indexN)) +
theme_esp() +
scale_x_date(date_labels = "%b\n%Y", breaks = generate_dates(cpi$date, 6)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, December 2024 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
cpi %>%
filter(item_name %in% median_terms$item_name | item_name == "Owners' equivalent rent of residences",
date %in% c(max(date), max(date) %m-% months(12))) %>%
select(date, Pchange3, item_name, weight) %>%
mutate(dateF = as.factor(date)) %>%
ggplot(aes(Pchange3, fill=dateF)) + geom_density()
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1,
indexN = 100*value/value[date == "2024-12-01"]) %>%
ungroup() %>%
filter(year(date) >= 2022) %>%
ggplot(aes(date, indexN)) +
theme_esp() +
scale_x_date(date_labels = "%b\n%Y", breaks = generate_dates(cpi$date, 6)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, December 2024 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1,
indexN = 100*value/value[date == "2024-12-01"]) %>%
ungroup() %>%
filter(year(date) >= 2019) %>%
ggplot(aes(date, indexN)) +
theme_esp() +
scale_x_date(date_labels = "%b\n%Y", breaks = generate_dates(cpi$date, 6)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, December 2024 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# Nobody is Coming Here Portfolio ----
cpi %>%
filter(item_name %in% c("Other lodging away from home including hotels and motels", "Airline fares")) %>%
group_by(item_name) %>%
mutate(Pchange4 = value/lag(value, 4) - 1,
indexN = 100*value/value[date == "2024-12-01"]) %>%
ungroup() %>%
filter(year(date) >= 2023) %>%
ggplot(aes(date, indexN)) +
theme_esp() +
scale_x_date(date_labels = "%b\n%Y", breaks = generate_dates(cpi$date, 6)) +
geom_line(size = 1.2, color="navy") +
facet_wrap(~item_name, scales = "free") +
labs(subtitle="Price level, December 2024 = 100",
title = "Hotels and Airfare Prices are Falling",
x="",
y="",
caption="Mike Konczal")
ggsave("graphics/nobody_is_coming_here.png", dpi="retina", width = 12, height=6.75, units = "in")
# CPI Analysis
# Written by: Mike Konczal
library(hrbrthemes)
library(ggrepel)
library(viridis)
library(ggridges)
library(gt)
library(govMacroTools)
library(tidyverse)
library(janitor)
# Download the data:
source("scripts/01_download_cpi_data.R")
# Load functions for drawing graphics:
source("scripts/02_general_graphic_scripts.R")
source("scripts/03_specific_graphic_scripts.R")
# First of the month!
df <- cpi_data %>%
filter(seasonal == "U", !is.na(date), area_code == "0000", substr(period, 1, 1) == "M") %>%
group_by(item_name) %>%
mutate(pchange1 = value / lag(value, 1) - 1) %>%
ungroup()
first_title <- "June Went the Wrong Direction"
years_array <- c(2019,2022, 2024, 2025)
second_title <- "Seasonally Unadjusted Values Returning to Broad Historical Range"
third_title <- "Compared to historical values, 2024 lines up"
cpi_data %>%
filter(seasonal == "U", !is.na(date), area_code == "0000", substr(period, 1, 1) == "M",
item_name %in% c("All items less food and energy")) %>%
mutate(pchange1 = value / lag(value, 1) - 1,
pchange12 = value / lag(value, 12) - 1) %>%
group_by(year) %>%
reframe(jan_change = pchange1[period == "M01"],
year_change = pchange12[period == "M12"]) %>%
ungroup() %>%
filter(!is.na(jan_change), year <= 2019) %>%
summarize(mean(jan_change/year_change))
#### First Graphic ####
df %>%
filter(item_name %in% c("All items less food and energy")) %>%
select(date, pchange1, item_name) %>%
mutate(month = month(date), year = as.factor(year(date))) %>%
filter(year(date) %in% years_array) %>%
ggplot(aes(month, pchange1, color = year)) +
geom_line(size = 1.2) +
geom_point(size = 1.2) +
theme_esp() +
scale_x_continuous(breaks = 1:12, labels = month.name) +
scale_y_continuous(labels = percent) +
geom_text_repel(aes(label = year),
size = 7,
data = . %>% group_by(year) %>% filter(month == 1) %>% ungroup(), nudge_x = -0.3
) +
labs(
title = first_title,
subtitle = "Seasonally unadjusted values for core CPI inflation, 1-month percent change, not annualized.",
caption = "Inspired by Paul Romer's blog. Mike Konczal"
)
ggsave("graphics/unadjusted_g1.png", dpi="retina", width = 12, height=6.75, units = "in")
